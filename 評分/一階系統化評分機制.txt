評分功能的順序
1 使用者輸入
2 在設定好的範圍 就透過目前這些內容 去進行總結以及評分
3 系統要根據使用者的對話 首先要找出有哪幾項評分是跟目前對話有關的
4 找到了n項評分標準後 判別這項評分 需不需要進行計算 所以我會有一個固定的 項目-函式 對應庫
5 根據這個項目函式對應 將部分需要的資訊放入後 就一並送入LLM做判斷
因為評分標準是預設好的 所以可以針對需要特殊prompt以及評分方式的項目
單獨各自寫function出來
內容計算就不要再建一個資料庫 因為這樣會重複太多 
然後還要測試1b模型能不能做到 評分後給總結

#在清腸瀉劑衛教中的重點 會有部分的注意提醒事項 這些可以放到第二階段評分內
需要完成的部分 檢查時間、第一包藥劑時間+服用方法、第二包藥劑時間+服用方法   、

評分有兩種途徑 一種是在對話中就會做總結以及評分 另一種則是在完整對話結束後才去做

還有一個重點 有不少評分項目 都是需要'''獨立prompt'''去評分的




適切發問及引導以獲得正確且足夠的訊息(醫療面談) 
有四條評估子項目 分別佔有1分
proper_guidance_s2 基本上是有問就有分
proper_guidance_s3 假設s2觸發狀況3 且使用者沒有對這部分做詢問 為 0分 有的話 1分 (也就是這類是特殊prompt)

說明藥物使用時機及方式 也有兩個子項目 所以在scoring_criteria.json裡面就不會去提及 "說明藥物使用時機及方式"
而是在最後對話結束時 去做評分的整理時再加進去就好 因為他就只是個計算 (第一子項+第二子項)/2*1
是否正確說明第一包清腸劑泡製方法及服用方式
是否正確說明第二包清腸劑泡製方法及服用方式

由於兩個的向量會非常相近 因此可能都會被觸發但沒關係 反正 確認正確的項目不會再被觸發

是否確認病人檢查型態
//有沒有用過清腸劑好像不太重要 就留著用來去做 "適切發問及引導以獲得正確且足夠的訊息"



檢查日期以及時間
今天日期 + agent_setting.check_day
檢查前一天:agent_setting.check_day-1 + 今天日期
檢查前兩天:agent_setting.check_day-2 + 今天日期
檢查前三天:agent_setting.check_day-3 + 今天日期

在不處理 檢查使用者有沒有說錯不能吃的東西 
檢查前三天 
不能吃的東西 奶類製品 起司 蔬菜水果 高纖豆漿 等
能吃的東西 白稀飯 白吐司 白饅頭 海綿蛋糕 白麵線 豆腐乳 去皮的魚肉 無加料蒸蛋
檢查前一天 無渣流質食物

第一包藥劑服用
檢查前一天 X月X日 下午5點
泡製方式:將一包「保可淨」散劑倒入裝有150c.c.常溫白開水的杯子中，攪拌至少５分鐘至粉劑完全溶解
溶解後將藥液喝完；杯內若有殘留藥粉，請再加少許冷開水並喝完。
檢查前一天 X月X日 下午6點 
備妥2000c.c.水分，於2-3小時內陸續分次喝完，或每15分鐘補充一杯250c.c.水分，共8杯。

第二包藥劑服用
泡製方式如第一劑
檢查當天 時間點計算邏輯function{
    檢查時間在早上10點前(不含10點) -> 凌晨3點服用
    檢查時間在早上10點~12點前(不含12點) -> 凌晨4點服用
    檢查時間在下午(12點後) -> 凌晨7點服用
    }

檢查前的注意事項(根據check_type去分別)
一般大腸鏡檢查，檢查前2小時之內 不能再喝水
無痛大腸鏡檢查，檢查前3小時之內 不能再喝水

範例一：緩解便秘藥物(KKK)請勿停藥，應繼續服用；其他藥品應於服用清腸劑前2小時或清腸後6小時服用。
範例二：抗凝血劑(RRR)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。
範例三：抗血小板藥物(QQQ)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。
範例四：降血糖藥物(PPP、AAA…)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。

臨床判斷部分 主要為藥物衛教

緩解便秘藥物

S:Special
抗凝血劑S1
抗血小板藥物S2
降血糖藥S3
緩解便秘用藥S4

高血壓藥物X1
抗癲癇藥物X2

以目前來說 由於並沒有隨機產生agent的行為
所以目前大概可以做
首先要先讀取目前這個session_id 使用的agent是哪個 然後去看他的med_code
然後可以直接寫在function裡面\
比如說像下面這樣存放

S1 : 抗凝血劑(RRR)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。
S2 : 抗血小板藥物(QQQ)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。
S3 : 降血糖藥物(PPP、AAA…)請依醫師指示停藥；其他藥品，應於服用清腸劑前2小時或清腸後6小時服用。
S4 : 緩解便秘藥物(KKK)請勿停藥，應繼續服用；其他藥品應於服用清腸劑前2小時或清腸後6小時服用。


模擬答案(A3):
需要計算或判斷的答案 都可以在create session之後馬上處理
今天 = 8月10號
check_day = 7
檢查日 = 8月17號
檢查前一日 = 8月16號
檢查前兩日 = 8月15號
檢查前三日 = 8月14號
檢查型態 = 不知道
COST = 4500 -> 代表無痛檢查

檢查前第二天、檢查前第三天 + 低渣飲食
檢查前一天 無渣流質食物

第一包藥劑服用不需要計算 只需要取得 檢查前一日的日期就可

第二包藥劑服用 才需要計算
檢查當天 時間點計算邏輯function{
    檢查時間在早上10點前(不含10點) -> 凌晨3點服用
    檢查時間在早上10點~12點前(不含12點) -> 凌晨4點服用
    檢查時間在下午(12點後) -> 凌晨7點服用
    }

check_time = 上午11:20
服用時間 = 凌晨4點服用

檢查前的注意事項(根據check_type去分別)
一般大腸鏡檢查，檢查前2小時之內 不能再喝水
無痛大腸鏡檢查，檢查前3小時之內 不能再喝水

check_time = 上午11:20
check_type = 無痛

上午8:20後就不能再喝水