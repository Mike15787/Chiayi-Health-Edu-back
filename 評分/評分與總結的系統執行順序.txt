使用者輸入達到一個上限之後 這邊先假設是三句話
也就是在main.py中 負責處理聊天的就是chat api
在這邊他會透過conversation_manager.should_summarize
當回傳為true時 這邊就會在背景開始總結
同時最好也開始在背景進行評分的工作

在這裡評分的工作我設計的流程是
首先我會有一個向量資料庫 scoring_criteria.json 這個資料庫內放的是眾多的評分項目以及這些項目的範例回答
要透過目前歷史紀錄的最新三筆使用者輸入 去向量資料庫進行語意相似度搜尋 取前K個與範例回答相似度高的評分項目
取得評分項目後 還要根據這個評分項目需不需要額外計算去做差別化並行評分
就如同下面我列出來的

###可以直接使用通用prompt檢查的項目###

知道如何查閱患者目前用藥(+4分) 
能詢問患者是否有使用此類藥物經驗(保可淨)(2分) (緩解便秘用藥 就算是一種瀉藥)
向病人問好(+1分)
請病人坐下(+1分)
確認是否本人使用(清腸劑/保可淨)(+1分)
+ 新增評分項目: 是否確認病人檢查型態(1分)
說明藥物開立目的(+0.5分) 
有詢問是否有使用降血糖或防栓塞藥物(+0.5分)
說明開始作用時間及平均時數(+0.5分)
確認是否進行無痛麻醉(+1分)
能做簡易飲食衛教(+0.5分)
能判斷病人是否有”特殊藥物”(降血糖/防栓塞/便祕藥物)(依案例而定)(+1分)

    ##且要額外靠function檢查、計算、使用另外prompt的項目

    能說明禁水時間(+1分) 主要是指有沒有提到禁水
    說明水分補充方式及清腸理想狀態(+1分)
    說明開始作用時間及平均時數(+0.5分)
    能依病人狀況判斷服藥時間(+1.5分)
    能依病人狀況判斷禁水時間(+1.5分)
    能依檢查時間判斷早上服藥時間點(+1.5分)
    能依病人狀況正確說明”特殊藥物”是否需停藥或續用(依案例而定)(+1.5分)

接下來要根據scoring_criteria.json內的type 

一般通用prompt
prompt = "你是一名專業的資深護理師，你要為正在練習大腸鏡衛教的學員評分
，請根據以下的對話(chat_history)，去判斷這名學員有沒有達成{評分項目}所要求的事，
你只需要輸出 達成/達成一半/沒有達成 其中一個答案 不需要多做任何解說"